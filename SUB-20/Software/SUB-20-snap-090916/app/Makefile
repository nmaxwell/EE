#------------------------------------------------------------------------------
# Main Targets
#------------------------------------------------------------------------------
all: sub_app

#------------------------------------------------------------------------------
# Config
#------------------------------------------------------------------------------
OS := $(shell uname)
ifeq ($(findstring Linux,$(OS)),Linux)
    OS=Linux
endif
ifeq ($(findstring CYGWIN,$(OS)),CYGWIN)
    OS=CYGWIN
endif

#------------------------------------------------------------------------------
# Compiler
#------------------------------------------------------------------------------

# C Compiler and Linker Executable
CC      := $(CROSS)gcc


#------------------------------------------------------------------------------
# Inc && Lib 
#------------------------------------------------------------------------------
LDLIB   := 

#------------------------------------------------------------------------------
# Compiler Flags 
#------------------------------------------------------------------------------
CFLAGS  := -O2 -Wall -Werror -g -I../lib -I../libusb/libusb-win32-src/src

#------------------------------------------------------------------------------
# Linker Flags 
#------------------------------------------------------------------------------
LDFLAGS := -lsub -L../lib
ifeq ($(OS),Linux)
	LDFLAGS += -L/usr/local/lib -lusb-1.0 -lm
else
 ifdef WIN_BLD
    LDFLAGS = -L"${PROGRAMFILES}\SUB-20\090714\lib\msvc" -lsub20
 else
	LDFLAGS += -L../libusb/libusb-win32-src -lusb
 endif
endif

#------------------------------------------------------------------------------
# Common rules
#------------------------------------------------------------------------------
%.o:	%.c  
	$(CC) -c $(CFLAGS) -o $@ $<


#------------------------------------------------------------------------------
# Target Builds
# 
#------------------------------------------------------------------------------
sub_app : sub_app.o cmd_pars.o
	$(CC) -o $@ $^ $(LDFLAGS)

clean:
	rm -f *.o *.out *.err *.exe *.a *.so sub_app

